<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>UOG Changelogs</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --bg:#05070f;
  --card:#0c1224;
  --neon:#00eaff;
  --neon2:#7c4dff;
}

body {
  margin:0;
  font-family:Segoe UI,system-ui;
  background:radial-gradient(circle at top,#0b132b,#02040a);
  color:#e6f1ff;
}

.app {
  display:grid;
  grid-template-columns:240px 1fr;
  min-height:100vh;
}

.sidebar {
  padding:20px;
  background:#040814;
  border-right:1px solid rgba(0,234,255,.3);
}

.content {
  padding:40px;
}

.card {
  background:var(--card);
  border:1px solid rgba(0,234,255,.35);
  box-shadow:0 0 20px rgba(0,234,255,.2);
  border-radius:10px;
  padding:20px;
  margin-bottom:20px;
}

h1,h2,h3 {
  color:var(--neon);
  text-shadow:0 0 10px rgba(0,234,255,.6);
}

input,textarea,button {
  width:100%;
  padding:12px;
  margin-top:10px;
  background:#02040a;
  color:white;
  border:1px solid rgba(0,234,255,.4);
  border-radius:6px;
}

button {
  cursor:pointer;
  color:var(--neon);
}

button:hover {
  background:rgba(0,234,255,.15);
}

#loginPanel {
  position:fixed;
  top:20px;
  right:20px;
  width:260px;
  z-index:1000;
}

details {
  margin-bottom:10px;
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>

<body>

<div class="app">
  <div class="sidebar">
    <h2>UOG</h2>
  </div>

  <div class="content">

    <div id="loginPanel" class="card">
      <h3>Login</h3>
      <input id="userInput" placeholder="Username">
      <input id="passInput" type="password" placeholder="Password">
      <button onclick="login()">Login</button>
      <button onclick="register()">Register</button>
    </div>

    <h1>Changelogs</h1>
    <div id="changelogs"></div>

    <div id="adminPanel" class="card" style="display:none">
      <h3>Admin Panel</h3>
      <input id="verInput" placeholder="Version">
      <textarea id="chgInput" placeholder="One change per line"></textarea>
      <button onclick="addChangelog()">Add</button>
    </div>

  </div>
</div>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey: "AIzaSyD9TWP_zvIbGQuOyjtE6aliFIfBx23wdyY",
  authDomain: "changelogs-website.firebaseapp.com",
  databaseURL: "https://changelogs-website-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "changelogs-website",
  storageBucket: "changelogs-website.firebasestorage.app",
  messagingSenderId: "98095071875",
  appId: "1:98095071875:web:98d7816bb0549349bf11b6",
  measurementId: "G-RRZ06NSB0G"
});

const db = firebase.database();
const usersRef = db.ref("users");
const changelogsRef = db.ref("changelogs");

/* ================= ADMIN HASH ================= */
/* password: admin123 */
const ADMIN_HASH =
"240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9";

/* ================= SESSION ================= */
let currentUser = localStorage.getItem("user");
let isAdmin = localStorage.getItem("admin") === "true";

if (currentUser) restoreSession();

/* ================= UTIL ================= */
async function sha256(text) {
  const buf = await crypto.subtle.digest(
    "SHA-256",
    new TextEncoder().encode(text)
  );
  return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,"0")).join("");
}

/* ================= AUTH ================= */
async function login() {
  const u = userInput.value.trim();
  const p = passInput.value;
  const h = await sha256(p);

  usersRef.child(u).once("value").then(snap => {
    const d = snap.val();
    if (!d) return alert("User not found");
    if (d.password !== h) return alert("Wrong password");

    currentUser = u;
    isAdmin = d.role === "admin";

    localStorage.setItem("user", u);
    localStorage.setItem("admin", isAdmin);

    restoreSession();
  });
}

async function register() {
  const u = userInput.value.trim();
  const p = passInput.value;
  if (!u || !p) return alert("Missing fields");

  const h = await sha256(p);

  usersRef.child(u).once("value").then(s => {
    if (s.exists()) return alert("User exists");

    usersRef.child(u).set({
      password: h,
      role: "user"
    });

    alert("Registered. Login now.");
  });
}

/* ================= RESTORE ================= */
function restoreSession() {
  loginPanel.style.display = "none";
  if (isAdmin) adminPanel.style.display = "block";
}

/* ================= CHANGELOGS ================= */
function loadChangelogs() {
  changelogsRef.on("value", snap => {
    changelogs.innerHTML = "";
    snap.forEach(s => {
      const d = s.val();
      const el = document.createElement("details");
      el.innerHTML = `<summary>${d.version}</summary>`;
      const ul = document.createElement("ul");
      d.changes.forEach(c=>{
        const li=document.createElement("li");
        li.textContent=c;
        ul.appendChild(li);
      });
      el.appendChild(ul);
      changelogs.appendChild(el);
    });
  });
}

loadChangelogs();

function addChangelog() {
  const v = verInput.value;
  const c = chgInput.value.split("\n").filter(Boolean);
  if (!v || !c.length) return alert("Missing data");

  changelogsRef.push({
    version: v,
    changes: c
  });

  verInput.value = "";
  chgInput.value = "";
}
</script>

</body>
</html>
